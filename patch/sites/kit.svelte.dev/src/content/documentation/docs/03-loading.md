---
title: Загрузка данных
---

Компонент, который является страницей или макетом, может экспортировать функцию `load`, которая будет запущена до того, как компонент будет создан. Эта функция запускается как на стороне клиента, так и на стороне сервера и позволяет получить данные для страницы, чтобы не делать этого в функции `onMount`, т.к. в таком случае придётся показывать пользователю индикатор загрузки.

```ts
// load TypeScript type definitions

export interface Fallthrough {
 	fallthrough?: true;
}

export interface LoadInput<
 	PageParams extends Record<string, string> = Record<string, string>,
 	Stuff extends Record<string, any> = Record<string, any>,
 	Session = any
 > {
	url: URL;
 	params: PageParams;
	fetch(info: RequestInfo, init?: RequestInit): Promise<Response>;
	session: Session;
 	stuff: Stuff;
}

export interface LoadOutput<
 	Props extends Record<string, any> = Record<string, any>,
 	Context extends Record<string, any> = Record<string, any>
 > {
	status?: number;
	error?: string | Error;
	redirect?: string;
	props?: Props;
 	stuff?: Stuff;
	maxage?: number;
} | Fallthrough
```
Наш пример страницы блога может содержать функцию `load`, как показано ниже:

```html
<script context="module">
	/** @type {import('@sveltejs/kit').Load} */
	export async function load({ params, fetch, session, stuff }) {
		const url = `/blog/${params.slug}.json`;
		const res = await fetch(url);

		if (res.ok) {
			return {
				props: {
					article: await res.json()
				}
			};
		}

		return {
			status: res.status,
			error: new Error(`Не могу загрузить ${url}`)
		};
	}
</script>
```

> Обратите внимание на `<script context="module">` — это необходимо, потому что `load` выполняется до визуализации компонента. Код для каждого экземпляра компонента должен быть размещен во втором теге `<script>`.

`load` в SvelteKit является эквивалентом функциям `getStaticProps` или `getServerSideProps` в Next.js или `asyncData` в Nuxt.js, за исключением того, что она работает как на сервере, так и на клиенте.

Если функция `load` возвращает `{fallthrough: true}`, SvelteKit будет [перебирать маршруты](#marshruty-dopolnitelno-perebor-marshrutov) пока один из них что-то не вернёт, или вернёт ответ с кодом 404.

SvelteKit `load` получает реализацию `fetch`, которая имеет следующие специальные свойства:
- он имеет доступ к файлам cookie на сервере
- он может делать запросы к собственным конечным точкам приложения без выполнения HTTP-запроса
- он делает копию ответа, когда вы его используете, а затем отправляет его встроенным в начальную загрузку страницы для гидрации 

`load` применяется только к компонентам [page](#marshruty-straniczy) и [layout](#makety) (не к компонентам, которые они импортируют) и работает как на сервере, так и в браузере с параметрами рендеринга по умолчанию.

> Код, вызываемый внутри блоков `load`:
>
> - следует использовать SvelteKit метод [`fetch`](#zagruzka-dannyh-poluchaemye-znacheniya-fetch), а не использовать нативный `fetch`
> - не следует ссылаться на `window`, `document` или любые объекты, специфичные для браузера
> - не ссылаться на какие-либо ключи API или секреты, которые будут доступны клиенту, а вместо этого вызывать конечную точку, которая использует любые необходимые секреты

> Мутирование любого общего состояния на сервере повлияет на всех клиентов, а не только на текущего.


### Получаемые значения

Функция `load` получает объект, содержащий пять полей — `url`, `params`, `fetch`, `session` и `stuff`. Функция «load» является реактивной и будет повторно запущена при изменении ее параметров, но только в том случае, если они используются в функции. В частности, если в функции используются `url`, `session` или `stuff`, они будут повторно запущены всякий раз, когда их значение изменится, а также для отдельных свойств `params`.

> Обратите внимание, что деструктурированных параметров в объявлении функции достаточно, чтобы считать их использованием.

#### url

`url` - это экземпляр [`URL`](https://developer.mozilla.org/en-US/docs/Web/API/URL), содержащий такие свойства, как `origin`, `hostname`, `pathname` и `searchParams`.

> В некоторых средах это происходит из заголовков запроса, которые [возможно, потребуется настроить] (#konfiguracziya-headers) во время рендеринга на стороне сервера

#### params

`params` происходит от `url.pathname` и имени файла маршрута.

Для примера имени файла маршрута, такого как `src/routes/a/[b]/[...c]` и `url.pathname` `/a/x/y/z`, объект `params` будет выглядеть следующим образом:

```js
{
	"b": "x",
	"c": "y/z"
}
 ```

#### fetch

Функция `fetch` является эквивалентом нативной функции `fetch` из Web API, которая может совершать запросы содержащие данные сессии. Она может использоваться как на клиента так и на сервере.

> Когда функция `fetch` запускается на сервере, полученный результат будет сериализован и размещён в HTML-разметке. Что позволяет функции `load` на клиенте получить идентичные данные моментально без лишнего сетевого запроса.

> Файлы cookie будут переданы только в том случае, если целевой хост совпадает с приложением SvelteKit или его поддоменом.

#### session

`session` может использоваться для передачи данных от сервера в текущий запрос, например идентификатор авторизованного пользователя. По умолчанию значение равно `undefined`. См. [`getSession`](#huki-getsession) в разделе [`Хуки`](#huki), чтобы узнать как использовать этот объект.

#### stuff

Объект `stuff` передаётся из компонента макета дочерним компонентам макетов и компонентам страниц, и может быть заполнен тем, что вам нужно сделать доступным. Для корневого компонента `__layout.svelte` он будет равен `{}`, но если функция `load` этого компонента возвращает объект со свойством `stuff`, оно будет доступно для всех функций `load` из дочерних компонентов.

### Возвращаемые значения

Если из `load` возвращается промис, страница не будет отображаться, пока промис не исполнится. У возвращаемого объекта может быть несколько свойств, все они опциональны:

#### status

Код ответа HTTP сервера. Если возвращается `error` – он должен быть из диапазонов `4xx` или `5xx`; при возвращении свойства `redirect` код нужно установить в диапазон `3xx`. По умолчанию код ответа равен `200`.

#### error

Если при выполнении функции `load` что-то пошло не так, поместите в это свойство объект `Error` или просто строку, описывающую проблему, не забыв указать код ответа в свойстве `status` равным числу в диапазонах `4xx` или `5xx`.

#### redirect

Если страница должна перенаправить пользователя на другую страницу (например, эта страница устарела, или пользователь должен сначала авторизоваться или ещё что-то), поместите в это свойство строку, содержащую путь по которому нужно переместить пользователя. Не забудьте указать код ответа в свойстве `status` равным числу в диапазоне `3xx`.

#### maxage

Чтобы страница была закеширована на клиенте, верните в этом свойстве число, равное количеству секунд, сколько страница должна находиться в кеше. Если при отображении страницы использовались какие-либо пользовательские данные (либо через `session`, либо через запрос `fetch` в функции `load`), результирующий заголовок будет включать `private`,  в противном случае там будет `public`, который позволит кешировать страницу различным CDN сервисам.

Это свойство может быть использовано только в компонентах страниц, но _не_ в компонентах макета.

#### props

Если функция `load` возвращает объект `props`, то он будет передан компоненту как его свойства, когда он будет отрисован.

#### stuff

Поля из этого объекта будут добавлены к существующим полям объекта `stuff`, который будет предан в функции `load` всех дочерних компонентов страниц и макетов.

Комбинированный `stuff` доступен для компонентов, использующих [хранилище страницы](#moduli-$app-stores) в качестве `$page.stuff`, обеспечивая механизм передачи данных страницами «вверх» на макеты.