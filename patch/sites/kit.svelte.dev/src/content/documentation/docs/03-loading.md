---
title: Загрузка данных
---

Компонент, который является страницей, может экспортировать функцию `load`, которая будет запущена до того, как компонент будет создан. Эта функция запускается как на стороне клиента, так и на стороне сервера и позволяет получить данные для страницы, чтобы не делать этого в функции `onMount`, т.к. в таком случае придётся показывать пользователю индикатор загрузки.

Наш пример страницы блога может содержать функцию `load`, как показано ниже. Обратите внимание на атрибут `context="module"` — он необходим, поскольку эта функция запускается до того как компонент будет отрисован:

```ts
type LoadInput = {
	page: {
		host: string;
		path: string;
		params: Record<string, string | string[]>;
		query: URLSearchParams;
	};
	fetch: (info: RequestInfo, init?: RequestInit) => Promise<Response>;
	session: any;
	context: Record<string, any>;
};

type LoadOutput = {
	status?: number;
	error?: Error;
	redirect?: string;
	props?: Record<string, any>;
	context?: Record<string, any>;
	maxage?: number;
};
```

```html
<script context="module">
	/**
	 * @type {import('@sveltejs/kit').Load}
	 */
	export async function load({ page, fetch, session, context }) {
		const url = `/blog/${page.params.slug}.json`;
		const res = await fetch(url);

		if (res.ok) {
			return {
				props: {
					article: await res.json()
				}
			};
		}

		return {
			status: res.status,
			error: new Error(`Не могу загрузить ${url}`)
		};
	}
</script>
```

`load` в SvelteKit является эквивалентом функциям `getStaticProps` или `getServerSideProps` в Next.js или `asyncData` в Nuxt.js, за исключением того, что он работает как на сервере, так и на клиенте.

Если функция `load` ничего не возвращает, SvelteKit будет [перебирать маршруты](#маршруты-дополнительно-перебор-маршрутов) пока один из них что-то не вернёт, или вернёт ответ с кодом 404.

> `load` применима только для компонента, который определяют страницу, но не для компонентов который он может импортировать.

### Получаемые значения

Функция `load` получает объект, содержащий четыре свойства — `page`, `fetch`, `session` и `context`.

#### page

`page` является объектом `{ host, path, params, query }` где `host` и`path` — это соответственно часть хоста и путь из URL, `params` вычисляется из `path` и имени файла страницы, и `query` – экземпляр объекта `URLSearchParams`.

Таким образом для примера выше `src/routes/blog/[slug].svelte` и для запрошенного URL `/blog/some-post?foo=bar&baz`, следующее будет верным:

- `page.path === '/blog/some-post'`
- `page.params.slug === 'some-post'`
- `page.query.get('foo') === 'bar'`
- `page.query.has('baz')`

#### fetch

Функция `fetch` является эквивалентом нативной функции `fetch` из Web API, которая может совершать запросы содержащие данные сессии. Она может использоваться как на клиента так и на сервере.

> Когда функция `fetch` запускается на сервере, полученный результат будет сериализован и размещён в HTML-разметке. Что позволяет функции `load` на клиенте получить идентичные данные моментально без лишнего сетевого запроса.

#### session

`session` может использоваться для передачи данных от сервера в текущий запрос, например идентификатор авторизованного пользователя. По умолчанию значение равно `undefined`. См. [`getSession`](#хуки-getsession) в разделе [`Хуки`](#хуки), чтобы узнать как использовать этот объект.

#### context

Объект `context` передаётся из компонента макета дочерним компонентам макетов и компонентам страниц. Для корневого компонента `$layout.svelte` он будет равен `{}`, но если функция `load` этого компонента возвращает объект со свойством `context`, оно будет доступно для всех функций `load` из дочерних компонентов.

> Важно помнить, что функция `load` запускается как на сервере так и в браузере. Поэтому код внутри этих функций должен учитывать следующие ограничения:
>
> - должен запускаться на том же домене что и API куда он обращается, если оно требует сохранение сессии
> - не должен ссылаться на `window`, `document` или иной объект специфичный для браузера
> - не должен включать в себя никаких API-ключей или иных секретов, которые станут доступны на клиентской части

### Возвращаемые значения

Если из `load` возвращается промис, страница не будет отображаться, пока промис не исполнится. У возвращаемого объекта может быть несколько свойств, все они опциональны:

#### status

Код ответа HTTP сервера. Если возвращается `error` – он должен быть из диапазонов `4xx` или `5xx`; при возвращении свойства `redirect` код нужно установить в диапазон `3xx`. По умолчанию код ответа равен `200`.

#### error

Если при выполнении функции `load` что-то пошло не так, поместите в это свойство объект `Error` или просто строку, описывающую проблему, не забыв указать код ответа в свойстве `status` равным числу в диапазонах `4xx` или `5xx`.

#### redirect

Если страница должна перенаправить пользователя на другую страницу (например, эта страница устарела, или пользователь должен сначала авторизоваться или ещё что-то), поместите в это свойство строку, содержащую путь по которому нужно переместить пользователя. Не забудьте указать код ответа в свойстве `status` равным числу в диапазоне `3xx`.

#### maxage

Чтобы страница была закеширована на клиенте, верните в этом свойстве число, равное количеству секунд, сколько страница должна находиться в кеше. Если при отображении страницы использовались какие-либо пользовательские данные (либо через `session`, либо через запрос `fetch` в функции `load`), результирующий заголовок будет включать `private`,  в противном случае там будет `public`, который позволит кешировать страницу различным CDN сервисам.

Это свойство может быть использовано только в компонентах страниц, но _не_ в компонентах макета.

#### props

Если функция `load` возвращает объект `props`, то он будет передан компоненту как его свойства, когда он будет отрисован.

#### context

Поля из этого объекта будут добавлены к существующим полям объекта `context`, который будет предан в функции `load` всех дочерних компонентов страниц и макетов.

Это свойство может быть использовано только в компонентах макетов, но _не_ в компонентах страниц.