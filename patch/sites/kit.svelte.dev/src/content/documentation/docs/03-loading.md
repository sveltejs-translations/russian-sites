---
title: Загрузка данных
---

Компонент, который является страницей или макетом, может экспортировать функцию `load`, которая будет запущена до того, как компонент будет создан. Эта функция запускается как на стороне клиента, так и на стороне сервера и позволяет получить данные для страницы, чтобы не делать этого в функции `onMount`, т.к. в таком случае придётся показывать пользователю индикатор загрузки.

Наш пример страницы блога может содержать функцию `load`, как показано ниже. Обратите внимание на атрибут `context="module"` — он необходим, поскольку эта функция запускается до того как компонент будет отрисован:

```ts
type LoadInput<
 	PageParams extends Record<string, string> = Record<string, string>,
 	Context extends Record<string, any> = Record<string, any>,
 	Session = any
 > = {
	page: {
		host: string;
		path: string;
		params: PageParams;
		query: URLSearchParams;
	};
	fetch: (info: RequestInfo, init?: RequestInit) => Promise<Response>;
	session: Session;
 	context: Context;
};

type LoadOutput<
 	Props extends Record<string, any> = Record<string, any>,
 	Context extends Record<string, any> = Record<string, any>
 > = {
	status?: number;
	error?: string | Error;
	redirect?: string;
	props?: Props;
 	context?: Context;
	maxage?: number;
};
```

```html
<script context="module">
	/**
	 * @type {import('@sveltejs/kit').Load}
	 */
	export async function load({ page, fetch, session, context }) {
		const url = `/blog/${page.params.slug}.json`;
		const res = await fetch(url);

		if (res.ok) {
			return {
				props: {
					article: await res.json()
				}
			};
		}

		return {
			status: res.status,
			error: new Error(`Не могу загрузить ${url}`)
		};
	}
</script>
```

`load` в SvelteKit является эквивалентом функциям `getStaticProps` или `getServerSideProps` в Next.js или `asyncData` в Nuxt.js, за исключением того, что она работает как на сервере, так и на клиенте.

Если функция `load` ничего не возвращает, SvelteKit будет [перебирать маршруты](#marshruty-dopolnitelno-perebor-marshrutov) пока один из них что-то не вернёт, или вернёт ответ с кодом 404.

> `load` применима только для компонента, который определяет страницу, но не для компонентов которые он может импортировать.
> Важно помнить, что функция `load` запускается как на сервере так и в браузере. Поэтому код внутри этих функций должен учитывать следующие ограничения:
>
> - следует использовать предоставленный SvelteKit метод [`fetch`](#zagruzka-dannyh-poluchaemye-znacheniya-fetch) для получения данных, чтобы избежать дублирования сетевых запросов
> - обычно должен запускаться на том же домене что и API куда он обращается, если требуется сохранение сессии
> - не должен ссылаться на `window`, `document` или иной объект специфичный для браузера
> - не должен включать в себя никаких API-ключей или иных секретов, которые станут доступны на клиентской части

### Получаемые значения

Функция `load` получает объект, содержащий четыре свойства — `page`, `fetch`, `session` и `context`. Функция `load` является реактивной и будет повторно запускаться при изменении ее параметров, но только в том случае, если они используются в функции. В частности, если в функции используются `page.query`, `page.path`, `session` или `context`, они будут повторно запускаться всякий раз, когда их значение изменится. Обратите внимание, что деструкции параметров в объявлении функции достаточно, чтобы считаться с их использованием. В приведенном выше примере функция `load({ page, fetch, session, context })` будет перезапускаться каждый раз при изменении `session` или `context`, даже если они не используются в теле функции. Если бы он был переписан как `load({ page, fetch })`, то он бы перезапускался только при изменении `page.params.slug`. Та же реактивность применима к `page.params`, но только к параметрам, фактически используемым в функции. Если `page.params.foo` изменится, приведенный выше пример не будет перезапускаться, потому что он не имел доступа к `page.params.foo`, а только к `page.params.slug`.

#### page

`page` является объектом `{ host, path, params, query }` где `host` и`path` — это соответственно часть хоста и путь из URL, `params` вычисляется из `path` и имени файла страницы, и `query` – экземпляр объекта [`URLSearchParams`](https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams).

Таким образом для примера выше `src/routes/blog/[slug].svelte` и для запрошенного URL `https://example.com/blog/some-post?foo=bar&baz&bizz=a&bizz=b`, следующее будет верным:

- `page.host === 'example.com'`
- `page.path === '/blog/some-post'`
- `page.params.slug === 'some-post'`
- `page.query.get('foo') === 'bar'`
- `page.query.has('baz')`
- `page.query.getAll('bizz') === ['a', 'b']`

#### fetch

Функция `fetch` является эквивалентом нативной функции `fetch` из Web API, которая может совершать запросы содержащие данные сессии. Она может использоваться как на клиента так и на сервере.

> Когда функция `fetch` запускается на сервере, полученный результат будет сериализован и размещён в HTML-разметке. Что позволяет функции `load` на клиенте получить идентичные данные моментально без лишнего сетевого запроса.

> Файлы cookie будут переданы только в том случае, если целевой хост совпадает с приложением SvelteKit или его поддоменом.

#### session

`session` может использоваться для передачи данных от сервера в текущий запрос, например идентификатор авторизованного пользователя. По умолчанию значение равно `undefined`. См. [`getSession`](#huki-getsession) в разделе [`Хуки`](#huki), чтобы узнать как использовать этот объект.

#### context

Объект `context` передаётся из компонента макета дочерним компонентам макетов и компонентам страниц. Для корневого компонента `__layout.svelte` он будет равен `{}`, но если функция `load` этого компонента возвращает объект со свойством `context`, оно будет доступно для всех функций `load` из дочерних компонентов.

### Возвращаемые значения

Если из `load` возвращается промис, страница не будет отображаться, пока промис не исполнится. У возвращаемого объекта может быть несколько свойств, все они опциональны:

#### status

Код ответа HTTP сервера. Если возвращается `error` – он должен быть из диапазонов `4xx` или `5xx`; при возвращении свойства `redirect` код нужно установить в диапазон `3xx`. По умолчанию код ответа равен `200`.

#### error

Если при выполнении функции `load` что-то пошло не так, поместите в это свойство объект `Error` или просто строку, описывающую проблему, не забыв указать код ответа в свойстве `status` равным числу в диапазонах `4xx` или `5xx`.

#### redirect

Если страница должна перенаправить пользователя на другую страницу (например, эта страница устарела, или пользователь должен сначала авторизоваться или ещё что-то), поместите в это свойство строку, содержащую путь по которому нужно переместить пользователя. Не забудьте указать код ответа в свойстве `status` равным числу в диапазоне `3xx`.

#### maxage

Чтобы страница была закеширована на клиенте, верните в этом свойстве число, равное количеству секунд, сколько страница должна находиться в кеше. Если при отображении страницы использовались какие-либо пользовательские данные (либо через `session`, либо через запрос `fetch` в функции `load`), результирующий заголовок будет включать `private`,  в противном случае там будет `public`, который позволит кешировать страницу различным CDN сервисам.

Это свойство может быть использовано только в компонентах страниц, но _не_ в компонентах макета.

#### props

Если функция `load` возвращает объект `props`, то он будет передан компоненту как его свойства, когда он будет отрисован.

#### context

Поля из этого объекта будут добавлены к существующим полям объекта `context`, который будет предан в функции `load` всех дочерних компонентов страниц и макетов.

Это свойство может быть использовано только в компонентах макетов, но _не_ в компонентах страниц.