---
question: Как исправить ошибку, которая происходит при попытке импортировать пакеты?
---

Поддержка Vite SSR стала довольно стабильной с версии Vite 2.7. Большинство проблем, с подключением библиотек, связаны с их неправильной упаковкой.

Библиотеки лучше всего работают с Vite, когда они предоставляют версию ESM, и вы можете предложить это авторам библиотек. Вот несколько вещей, которые следует иметь в виду при проверке правильной упаковки библиотеки:
- `exports` имеет приоритет над другими полями эндпоинтов, такими как `main` и `module`. Добавление поля `exports` может быть не обратно совместимым, так как предотвращает глубокий импорт.
- ESM-файлы должны заканчиваться на `.mjs`, если не установлен `"type": "module"`, и в любом случае файлы CommonJS должны заканчиваться на `.cjs`.
- `main` должен быть определен, если `exports` не определен. Это должен быть файл CommonJS или ESM и придерживаться предыдущего маркера. Если определено поле `module`, оно должно ссылаться на файл ESM.
- Компоненты Svelte должны быть полностью представлены как ESM и иметь поле `svelte`, определяющее эндпоинт.

Рекомендуется убедиться, что зависимости внешних компонентов Svelte обеспечивают версию ESM. Однако для обработки зависимостей CommonJS [`vite-plugin-svelte` будет искать любые зависимости CJS внешних компонентов Svelte](https://github.com/sveltejs/vite-plugin-svelte/blob/main/docs/faq.md#what-is-going-on-with-vite-and-pre-bundling-dependencies) и попросит Vite предварительно сгруппировать их, автоматически добавив их в `optimizeDeps.include` Vite, которые будет использовать `esbuild` для преобразования их в ESM. При таком подходе загрузка начальной страницы занимает больше времени. Если это становится заметным, попробуйте установить [experimental.prebundleSvelteLibraries: true](https://github.com/sveltejs/vite-plugin-svelte/blob/main/docs/config.md#prebundlesveltelibraries) в `svelte.config.js`. Обратите внимание, что эта опция является экспериментальной.

Если вы все еще сталкиваетесь с проблемами, мы рекомендуем проверить [список известных проблем Vite, наиболее часто затрагивающих пользователей SvelteKit](https://github.com/sveltejs/kit/issues/2086) и поискать их в [трекере проблем Vite](https://github.com/vitejs/vite/issues), или в трекере проблем соответствующей библиотеки. Иногда проблемы можно обойти, возясь со значениями конфигурации [`optimizeDeps`](https://vitejs.dev/config/#dep-optimization-options) или [`ssr`](https://vitejs.dev/config/#ssr-options).